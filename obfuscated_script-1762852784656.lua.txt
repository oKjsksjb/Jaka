local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "QFlowX_Button"
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = Player:WaitForChild("PlayerGui")

local OpenButton = Instance.new("TextButton")
OpenButton.Parent = ScreenGui
OpenButton.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
OpenButton.Size = UDim2.new(0, 150, 0, 40)
OpenButton.Position = UDim2.new(0.5, -75, 0, 0)
OpenButton.Text = "Open QFlowX"
OpenButton.TextColor3 = Color3.fromRGB(255, 255, 255)
OpenButton.Font = Enum.Font.GothamBold
OpenButton.TextSize = 16
OpenButton.ZIndex = 9999
OpenButton.AutoButtonColor = true

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0.9, 0)
Corner.Parent = OpenButton

OpenButton.MouseButton1Click:Connect(function()
	VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.RightShift, false, game)
	VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.RightShift, false, game)
end)

local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
	Title = "QFlowX DNS",
	SubTitle = "by zel pogi",
	TabWidth = 160,
	Size = UDim2.fromOffset(450, 300),
	Acrylic = false,
	Theme = "Light",
	MinimizeKey = Enum.KeyCode.RightShift
})

local InfoTab = Window:AddTab({Title="Info", Icon="info"})
local HomeTab = Window:AddTab({Title="Home", Icon="home"})
local OthersTab = Window:AddTab({Title="Others", Icon="layers"})
local ServerTab = Window:AddTab({Title="Server", Icon="server"})

InfoTab:AddParagraph({Title="QFlowOnTop", Content="Undetected DNS Script"})
InfoTab:AddParagraph({Title="version?", Content="beta v0.01"})
InfoTab:AddButton({Title="Copy Discord", Callback=function()
	setclipboard("https://discord.gg/ZyUCuhw6uQ")
	Fluent:Notify({Title="Copied!", Content="Discord link copied to clipboard.", Duration=4})
end})

_G.AutoFarm = false
_G.InfStats = false
_G.Spinning = false
local spinSpeed = 100

HomeTab:AddToggle("AutoCoins", {Title="Auto Coins", Description="manual auto coins", Default=false}):OnChanged(function(value)
	_G.AutoFarm = value
end)

HomeTab:AddButton({Title="Add Exp", Description="get 100k exp", Callback=function()
	local plr = Players.LocalPlayer
	if plr:FindFirstChild("leaderstats") and plr.leaderstats:FindFirstChild("Exp") then
		plr.leaderstats.Exp.Value = 100000
		Fluent:Notify({Title="Exp Added", Content="Your Exp has been set to 100k", Duration=4})
	end
end})

HomeTab:AddButton({Title="KM Farmer", Description="Boost your KM", Callback=function()
	local RunService = game:GetService("RunService")
	local plr = Players.LocalPlayer
	local char = plr.Character or plr.CharacterAdded:Wait()
	local hrp = char:WaitForChild("HumanoidRootPart")
	local targetPos = Vector3.new(17790.96, 12.95, -1106.35)
	local riseHeight = 80
	local riseTime = 10
	local moveTime = 180
	local descendTime = 10

	local function easeInOut(t)
		return t < 0.5 and 2*t*t or -1 + (4-2*t)*t
	end

	local function setAnchored(model, value)
		for _, part in ipairs(model:GetDescendants()) do
			if part:IsA("BasePart") then part.Anchored = value end
		end
	end

	local function smoothMove(part, goalPos, duration)
		local startPos = part.Position
		local distance = (goalPos - startPos)
		local startTime = tick()
		local conn
		conn = RunService.Heartbeat:Connect(function()
			local elapsed = tick() - startTime
			local alpha = math.clamp(elapsed/duration,0,1)
			local smoothAlpha = easeInOut(alpha)
			local newPos = startPos + distance*smoothAlpha
			part.CFrame = CFrame.new(newPos, part.CFrame.LookVector)
			if alpha >= 1 then conn:Disconnect() end
		end)
		task.wait(duration)
	end

	local seat = char:FindFirstChildWhichIsA("VehicleSeat", true)
	if seat and seat.Occupant then
		local vehicle = seat:FindFirstAncestorWhichIsA("Model")
		if vehicle then
			if not vehicle.PrimaryPart then vehicle.PrimaryPart = seat end
			local root = vehicle.PrimaryPart
			setAnchored(vehicle,true)
			smoothMove(root,Vector3.new(root.Position.X,riseHeight,root.Position.Z),riseTime)
			smoothMove(root,Vector3.new(targetPos.X,riseHeight,targetPos.Z),moveTime)
			smoothMove(root,targetPos,descendTime)
			setAnchored(vehicle,false)
		end
	else
		smoothMove(hrp,Vector3.new(hrp.Position.X,riseHeight,hrp.Position.Z),riseTime)
		smoothMove(hrp,Vector3.new(targetPos.X,riseHeight,targetPos.Z),moveTime)
		smoothMove(hrp,targetPos,descendTime)
	end
end})

HomeTab:AddToggle("ProtectUsername", {Title="Protect Username", Description="Protect your name", Default=true}):OnChanged(function(value)
	local LocalPlayer = Players.LocalPlayer
	local REAL_NAME = LocalPlayer.Name
	local PROTECTED_TAG = "Protected by QFlowX"

	local function protectText(obj)
		if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
			if obj.Text and string.find(string.lower(obj.Text), string.lower(REAL_NAME)) then
				obj.Text = string.gsub(obj.Text, REAL_NAME, PROTECTED_TAG)
			end
		end
	end

	local function protectCharacter(character)
		local humanoid = character:FindFirstChildOfClass("Humanoid")
		if humanoid then humanoid.DisplayName = PROTECTED_TAG end
	end

	if LocalPlayer.Character then protectCharacter(LocalPlayer.Character) end
	LocalPlayer.CharacterAdded:Connect(protectCharacter)
	game.DescendantAdded:Connect(function(obj) task.defer(function() protectText(obj) end) end)

	task.spawn(function()
		while true do
			task.wait(2)
			for _, guiObj in ipairs(LocalPlayer:FindFirstChild("PlayerGui"):GetDescendants()) do
				protectText(guiObj)
			end
		end
	end)
end)

HomeTab:AddToggle("InfHungerThirst", {Title="Inf Hunger and Thirst", Description="Fill Hunger and Thirst to 100", Default=false}):OnChanged(function(value)
	_G.InfStats = value
end)

HomeTab:AddButton({Title="Open JeepBoost", Callback=function()
	loadstring(game:HttpGet("https://pastefy.app/LClTLgKX/raw"))()
end})

OthersTab:AddToggle("SpinToggle", {Title="Spin", Description="Spin your character", Default=false}):OnChanged(function(value)
	_G.Spinning = value
end)

OthersTab:AddSlider("SpinSpeedSlider", {Title="Spin Speed", Description="Customize spin speed", Default=100, Min=1, Max=1000, Rounding=1}):OnChanged(function(val)
	spinSpeed = val
end)

OthersTab:AddToggle("PerformanceMode", {Title="Performance Mode", Description="Remove fog and shadows", Default=false}):OnChanged(function(value)
	if value then
		game.Lighting.FogEnd = 1e9
		game.Lighting.FogStart = 0
		game.Lighting.GlobalShadows = false
	else
		game.Lighting.FogEnd = 1000
		game.Lighting.FogStart = 0
		game.Lighting.GlobalShadows = true
	end
end)

ServerTab:AddButton({Title="Server Hop", Description="Teleport to a different server", Callback=function()
	local placeId = game.PlaceId
	local function getServers(cursor)
		local url = ("https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=Asc&limit=100"):format(placeId)
		if cursor then url = url.."&cursor="..cursor end
		local success, res = pcall(function() return HttpService:RequestAsync({Url=url, Method="GET"}) end)
		if not success then return nil end
		return HttpService:JSONDecode(res.Body)
	end
	local data = getServers(nil)
	if not data or not data.data then return end
	local servers = {}
	for _, s in pairs(data.data) do
		if s.id and s.playing < s.maxPlayers and s.id ~= game.JobId then table.insert(servers,s.id) end
	end
	if #servers > 0 then
		TeleportService:TeleportToPlaceInstance(placeId, servers[math.random(1,#servers)], Player)
	else
		Fluent:Notify({Title="No Server", Content="Could not find another server", Duration=4})
	end
end})

ServerTab:AddButton({Title="Rejoin", Description="Leave and rejoin the same server", Callback=function()
	TeleportService:Teleport(game.PlaceId, Player)
end})

ServerTab:AddButton({Title="Go to Small Server", Description="Join server with few players", Callback=function()
	local placeId = game.PlaceId
	local nextCursor, found = nil, false
	repeat
		local url = ("https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=Asc&limit=100"):format(placeId)
		if nextCursor then url = url.."&cursor="..nextCursor end
		local success,res = pcall(function() return HttpService:RequestAsync({Url=url, Method="GET"}) end)
		if success then
			local data = HttpService:JSONDecode(res.Body)
			for _, s in pairs(data.data) do
				if s.playing < (s.maxPlayers/2) and s.id~=game.JobId then
					TeleportService:TeleportToPlaceInstance(placeId,s.id,Player)
					found = true
					break
				end
			end
			nextCursor = data.nextPageCursor
		else
			break
		end
	until not nextCursor or found
	if not found then Fluent:Notify({Title="No Small Server", Content="Could not find a small server", Duration=4}) end
end})

task.spawn(function()
	local Remotes = ReplicatedStorage:WaitForChild("Remotes", 10)
	local RecieveCoin = Remotes:WaitForChild("RecieveCoin", 10)
	local Jeepnies = Workspace:WaitForChild("Jeepnies", 10)
	local Jeepney = Jeepnies:WaitForChild(Player.Name, 10)
	local PassengerValues = Jeepney:WaitForChild("PassengerValues", 10)

	RunService.Heartbeat:Connect(function()
		if _G.AutoFarm then
			pcall(function()
				RecieveCoin:FireServer({
					PassengerValues = PassengerValues,
					Password = 838875481,
					Main = true,
					Value = 300
				})
			end)
		end

		if _G.InfStats then
			for _, plr in ipairs(Players:GetPlayers()) do
				local stats = plr:FindFirstChild("stats")
				if stats then
					if stats:FindFirstChild("Hunger") then stats.Hunger.Value = 100 end
					if stats:FindFirstChild("Thirst") then stats.Thirst.Value = 100 end
				end
			end
		end

		if _G.Spinning and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
			Player.Character.HumanoidRootPart.CFrame = Player.Character.HumanoidRootPart.CFrame * CFrame.Angles(0, math.rad(spinSpeed), 0)
		end
	end)
end)
